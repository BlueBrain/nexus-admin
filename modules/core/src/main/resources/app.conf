# All application specific configuration should reside here
app {
  # The service description namespace
  description {
    # The name of the service
    name = "admin"
  }

  # Service instance specific settings
  instance {
    # The default interface to bind to
    interface = 127.0.0.1
    interface = ${?BIND_INTERFACE}
  }

  sparql {
    # The base uri to the sparql http endpoint
    base = "http://localhost:9999/bigdata"
    base = ${?SPARQL_BASE_URI}
    # Index name (namespace) for indexing
    namespace = "admin"
    namespace = ${?SPARQL_NAMESPACE}
    # The optional basic auth credentials to access the endpoint
    username = ${?SPARQL_USERNAME}
    password = ${?SPARQL_PASSWORD}
  }

  # Http binding settings
  http {
    # The interface to bind to
    interface = ${app.instance.interface}
    # The port to bind to
    port = 8080
    port = ${?BIND_PORT}
    # The default uri prefix
    prefix = "v1"
    prefix = ${?HTTP_PREFIX}
    # The service public uri
    public-uri = "http://"${app.http.interface}":"${app.http.port}
    public-uri = ${?PUBLIC_URI}
  }

  # Service runtime settings
  runtime {
    # Arbitrary Future completion timeout
    default-timeout = 30 seconds
  }

  # Cluster specific settings
  cluster {
    # Duration after which actors are shutdown if they have no interaction
    passivation-timeout = 10 seconds
    passivation-timeout = ${?PASSIVATION_TIMEOUT}
    # Total number of shards in the cluster
    shards = 30
    shards = ${?SHARDS}
    # The seeds to use for joining a cluster.  Should not contain the self address.
    # Example: 127.0.0.1:2552,127.0.0.2:2552,127.0.0.3:2552
    seeds = ${?SEED_NODES}
  }

  # Persistence specific settings
  persistence {
    journal-plugin = "cassandra-journal"
    snapshot-store-plugin = "cassandra-snapshot-store"
    query-journal-plugin = "cassandra-query-journal"
    default-tag = "event"
  }

  # Projects specific settings
  projects {
    passivation-timeout = 10 minutes
    passivation-timeout = ${?PROJECTS_PASSIVATION_TIMEOUT}
    namespace = ${app.http.public-uri}"/"${app.http.prefix}"/projects/"
    namespace = ${?PROJECT_JSONLD_NAMESPACE}
    # Attachment size in bytes. Default = 100MB
    attachment-size = 100000
    attachment-size = ${?PROJECT_ATTACHMENT_SIZE}
  }

  # Organizations specific settings
  organizations {
    passivation-timeout = 10 minutes
    passivation-timeout = ${?ORGANIZATIONS_PASSIVATION_TIMEOUT}
    namespace = ${app.http.public-uri}"/"${app.http.prefix}"/orgs/"
    namespace = ${?ORGANIZATIONS_JSONLD_NAMESPACE}
  }

  # Collection of prefixes used throughout the service
  prefixes {
    # Nexus contexts definitions
    core-context = ${app.http.public-uri}"/"${app.http.prefix}"/contexts/nexus/core/resource/v0.3.0"
    core-context = ${?NEXUS_CORE_CONTEXT}
    standards-context = ${app.http.public-uri}"/"${app.http.prefix}"/contexts/nexus/core/standards/v0.1.0"
    standards-context = ${?NEXUS_STD_CONTEXT}
    links-context = ${app.http.public-uri}"/"${app.http.prefix}"/contexts/nexus/core/links/v0.2.0"
    links-context = ${?NEXUS_LINKS_CONTEXT}
    search-context = ${app.http.public-uri}"/"${app.http.prefix}"/contexts/nexus/core/search/v0.1.0"
    search-context = ${?NEXUS_SEARCH_CONTEXT}
    distribution-context = ${app.http.public-uri}"/"${app.http.prefix}"/contexts/nexus/core/distribution/v0.1.0"
    distribution-context = ${?NEXUS_DIST_CONTEXT}
    error-context = ${app.http.public-uri}"/"${app.http.prefix}"/contexts/nexus/core/error/v0.1.0"
    error-context = ${?NEXUS_ERROR_CONTEXT}
  }

  # IAM connection settings
  iam {
    # IAM base URI endpoint
    base-uri = "http://localhost:8080/v0"
    base-uri = ${?IAM_BASEURI}
  }

  # Pagination configuration
  pagination {
    from = 0
    size = 50
    size = ${?PAGINATION_DEFAULT_SIZE}
    max-size = 300
    max-size = ${?PAGINATION_MAX_SIZE}

  }

  # Order of the JSON keys on the response payload
  order {
    response-keys = ["@context", "@id", "@type", "", "_rev", "_deprecated", "_results", "_total", "_links"]
  }

  # Collection of Kafka topics for each type of resource to publish
  # The topic name must match the resource type tag, see Resources#tags
  kafka {
    topic = "admin-events"
    topic = ${?KAFKA_TOPIC}
  }

  indexing {
    # Maximum number of events taken on each batch
    batch = 10
    batch = ${?INDEXING_BATCH}

    # Maximum amount of time to wait for the number of events to be taken on each batch
    batch-timeout = 400 millis
    batch-timeout  = ${?INDEXING_BATCH_TIMEOUT}


    retry {
      # The maximum number of times an index function is retried
      max-count = 10
      max-count  = ${?INDEXING_RETRY_MAX}

      # The maximum amount of time to wait between two retries
      max-duration = 20 seconds

      # The jitter added between retries
      random-factor = 0.2
    }
  }
}
